<app-toolbar />

<div class="character-list-container">
  <header class="header">
    <h1>Rick and Morty Characters</h1>
    
    <div class="filters-container">
    <div class="filters">
      <input 
        type="text" 
        class="filter-input"
        placeholder="Name"
        [(ngModel)]="nameFilter"
        (ngModelChange)="applyFilters()"
        (keyup.enter)="applyFilters()"
      />
      
      <select 
        class="filter-select"
        [(ngModel)]="statusFilter"
        (change)="applyFilters()"
      >
        <option value="">Status</option>
        <option value="alive">Alive</option>
        <option value="dead">Dead</option>
        <option value="unknown">Unknown</option>
      </select>
      
      <select 
        class="filter-select"
        [(ngModel)]="speciesFilter"
        (change)="applyFilters()"
      >
        <option value="">Species</option>
        <option value="Human">Human</option>
        <option value="Alien">Alien</option>
        <option value="Humanoid">Humanoid</option>
        <option value="Robot">Robot</option>
        <option value="Cronenberg">Cronenberg</option>
        <option value="Animal">Animal</option>
        <option value="Disease">Disease</option>
        <option value="Poopybutthole">Poopybutthole</option>
        <option value="Mythological Creature">Mythological Creature</option>
      </select>
      
      <button 
        class="clear-filters-btn"
        (click)="clearFilters()"
        [disabled]="!hasActiveFilters()"
        title="Clear all filters"
      >
        Clear Filters
      </button>
    </div>
    </div>
  </header>

  @if (loading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Loading characters...</p>
    </div>
  } @else if (error()) {
    <div class="error">
      <p>{{ error() }}</p>
      <button (click)="loadCharacters()">Retry</button>
    </div>
  } @else if (characters().length === 0) {
    <div class="no-results">
      <p>No characters found</p>
    </div>
  } @else {
    <div class="characters-grid">
      @for (character of characters(); track character.id) {
        <div class="character-card" (click)="openDetail(character)">
          <div class="character-image">
            <div class="image-loader"></div>
            <img 
              [src]="character.image" 
              [alt]="character.name"
              (load)="$any($event.target).previousElementSibling.style.display='none'"
              (error)="onImageError($event)"
            />
          </div>
          <div class="character-info">
            <h3 class="character-name">{{ character.name }}</h3>
            <p class="character-detail">{{ character.status }}</p>
          </div>
        </div>
      }
    </div>

    <div class="pagination">
      @for (page of visiblePages(); track $index) {
        @if (page === -1) {
          <span class="ellipsis">...</span>
        } @else {
          <button 
            class="page-button"
            [class.active]="page === currentPage()"
            (click)="goToPage(page)"
          >
            {{ page }}
          </button>
        }
      }
    </div>
  }
</div>

<router-outlet />
